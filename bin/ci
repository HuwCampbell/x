#!/bin/sh -exu

$(dirname $0)/ci.branches

VERSION=$(date '+%Y%m%d%H%M%S')-$(git log --pretty=format:%h -n 1)

MODULES=$(ls x-*/*.cabal)

for x in $MODULES; do
    (
        SUBMODULE=$(dirname $x | xargs basename)
        cd $SUBMODULE
        cabal haddock --hoogle

        aws s3 --region=ap-southeast-2 cp --recursive dist/doc/html/ambiata-$SUBMODULE/ s3://ambiata-doc/ambiata-$SUBMODULE-haddock/$VERSION
    )
done
