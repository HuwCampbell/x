#!/bin/sh -exu

export LC_COLLATE=en_US.UTF-8
export LANG=en_US.UTF-8

git submodule init
git submodule sync
git submodule update

MODULES=$(ls x-*/*.cabal)

for x in $MODULES; do
    (
        cd $(dirname $)
        ./cabal update || exit $?
        ./cabal build || exit $?
        ./cabal test || exit $?
    )
done
