#!/bin/sh -exu

export LC_COLLATE=en_US.UTF-8
export LANG=en_US.UTF-8

git submodule init
git submodule sync
git submodule update

MODULES=$(ls x-*/*.cabal)

for x in $MODULES; do
    (
        cd $(dirname $x)
        ./mafia update || exit $?
        ./mafia build || exit $?
        ./mafia testci || exit $?
    )
done
